<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Show</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            user-select: none;
            touch-action: manipulation;
        }
    </style>
</head>

<body>
    <header>
        <div>Team 1: <span id="team1Points">0</span> Punkte</div>
        <div>Team 2: <span id="team2Points">0</span> Punkte</div>
        <button id="nextButton" onclick="location.href='rules.html'">Weiter</button>
    </header>
    <h1>Game Show</h1>
    <p>Namen eingeben, um sie den Teams zuzuweisen:</p>
    <form id="nameForm">
        <textarea id="nameInput" placeholder="Name 1, Name 2, ..." required></textarea>
        <button type="submit">Teams zuweisen</button>
    </form>
    <div id="teams">
        <div id="team1">
            <h2>Team 1</h2>
            <ul id="team1List"></ul>
        </div>
        <div id="team2">
            <h2>Team 2</h2>
            <ul id="team2List"></ul>
        </div>
    </div>
    <button id="clearCacheButton"
        style="position: fixed; bottom: 10px; right: 10px; padding: 10px; font-size: 0.8em; display: none;">Cache
        leeren</button>

    <!-- Background Music Controls -->
    <div class="music-controls" id="musicControls" onclick="event.stopPropagation();">
        <button class="music-toggle" id="musicToggle" onclick="event.stopPropagation();">
            ◀
        </button>
        <div class="music-controls-content">
            <div class="music-controls-row">
                <button id="musicPlayPause" title="Play/Pause">▶</button>
                <div class="volume-control">
                    <input type="range" id="musicVolume" min="0" max="100" value="10" title="Volume">
                    <span class="volume-label" id="volumeLabel">10%</span>
                </div>
                <button id="musicNext" title="Next Track">⏭</button>
            </div>
            <div class="music-timeline" id="musicTimeline">
                <div class="timeline-bar">
                    <div class="timeline-progress" id="timelineProgress"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="background-music-player.js"></script>
    <script src="script.js"></script>
    <script>
        document.getElementById('clearCacheButton').addEventListener('click', function () {
            localStorage.clear();
            alert('Cache wurde geleert');
            location.reload();
        });

        window.addEventListener('load', function () {
            if (localStorage.length > 0) {
                document.getElementById('clearCacheButton').style.display = 'block';
            }

            // Start background music on first click (removed auto-start)
            // User can now manually control via the music controls

            // Setup music controls
            const playPauseBtn = document.getElementById('musicPlayPause');
            const volumeSlider = document.getElementById('musicVolume');
            const nextBtn = document.getElementById('musicNext');
            const musicToggle = document.getElementById('musicToggle');
            const musicControls = document.getElementById('musicControls');
            let controlsVisible = false;
            let lastMousePosition = { x: 0, y: 0 };
            let mouseMovedDistance = 0;

            // Show controls on hover
            if (musicToggle) {
                musicToggle.addEventListener('mouseenter', (e) => {
                    controlsVisible = true;
                    musicControls.classList.add('visible');
                    musicToggle.innerHTML = '▶';
                    lastMousePosition = { x: e.clientX, y: e.clientY };
                    mouseMovedDistance = 0;
                });
            }

            // Auto-hide controls when clicking outside
            document.addEventListener('click', (e) => {
                if (controlsVisible && !musicControls.contains(e.target)) {
                    controlsVisible = false;
                    musicControls.classList.remove('visible');
                    if (musicToggle) {
                        musicToggle.innerHTML = '◀';
                    }
                }
            });

            // Auto-hide controls when mouse moves 200px away
            document.addEventListener('mousemove', (e) => {
                if (!controlsVisible) return;

                // Check if mouse is over the controls or toggle
                const rect = musicControls.getBoundingClientRect();
                const toggleRect = musicToggle ? musicToggle.getBoundingClientRect() : null;
                const isOverControls = (
                    e.clientX >= rect.left &&
                    e.clientX <= rect.right &&
                    e.clientY >= rect.top &&
                    e.clientY <= rect.bottom
                );
                const isOverToggle = toggleRect && (
                    e.clientX >= toggleRect.left &&
                    e.clientX <= toggleRect.right &&
                    e.clientY >= toggleRect.top &&
                    e.clientY <= toggleRect.bottom
                );

                if (isOverControls || isOverToggle) {
                    // Reset tracking when over controls or toggle
                    lastMousePosition = { x: e.clientX, y: e.clientY };
                    mouseMovedDistance = 0;
                } else {
                    // Calculate distance moved
                    const deltaX = e.clientX - lastMousePosition.x;
                    const deltaY = e.clientY - lastMousePosition.y;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    mouseMovedDistance += distance;
                    lastMousePosition = { x: e.clientX, y: e.clientY };

                    // Hide if moved more than 200px
                    if (mouseMovedDistance > 200) {
                        controlsVisible = false;
                        musicControls.classList.remove('visible');
                        if (musicToggle) {
                            musicToggle.innerHTML = '◀';
                        }
                        mouseMovedDistance = 0;
                    }
                }
            });

            // Make timeline clickable to seek
            const timeline = document.getElementById('musicTimeline');
            if (timeline) {
                timeline.addEventListener('click', (e) => {
                    if (window.backgroundMusicPlayer && window.backgroundMusicPlayer.isPlaying) {
                        const audio = window.backgroundMusicPlayer.audioElements[window.backgroundMusicPlayer.currentAudioIndex];
                        if (audio && audio.duration) {
                            const rect = timeline.getBoundingClientRect();
                            const clickX = e.clientX - rect.left;
                            const percentage = clickX / rect.width;
                            audio.currentTime = percentage * audio.duration;
                        }
                    }
                });
                timeline.style.cursor = 'pointer';
            }

            // Update timeline
            setInterval(() => {
                if (window.backgroundMusicPlayer && window.backgroundMusicPlayer.isPlaying) {
                    const audio = window.backgroundMusicPlayer.audioElements[window.backgroundMusicPlayer.currentAudioIndex];
                    if (audio && audio.src && !isNaN(audio.duration) && audio.duration > 0) {
                        const progress = (audio.currentTime / audio.duration) * 100;
                        const progressBar = document.getElementById('timelineProgress');
                        if (progressBar) {
                            progressBar.style.width = progress + '%';
                        }
                    }
                }
            }, 100);

            playPauseBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (window.backgroundMusicPlayer) {
                    if (window.backgroundMusicPlayer.isPlaying) {
                        window.backgroundMusicPlayer.pause();
                        playPauseBtn.textContent = '▶';
                    } else {
                        // Check if music was ever started
                        if (window.backgroundMusicPlayer.audioElements[window.backgroundMusicPlayer.currentAudioIndex].src) {
                            // Resume paused music
                            window.backgroundMusicPlayer.resume();
                        } else {
                            // Start music for the first time
                            window.backgroundMusicPlayer.start();
                        }
                        playPauseBtn.textContent = '⏸';
                    }
                }
            });

            volumeSlider.addEventListener('input', (e) => {
                if (window.backgroundMusicPlayer) {
                    const volume = e.target.value;
                    window.backgroundMusicPlayer.setVolume(volume / 100);
                    document.getElementById('volumeLabel').textContent = volume + '%';
                }
            });

            nextBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (window.backgroundMusicPlayer) {
                    window.backgroundMusicPlayer.skipToNext();
                }
            });
        });
    </script>
</body>

</html>
